<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>POS Firebase Ready</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
body{font-family:sans-serif;background:#f4f4f4;padding:20px;display:flex;flex-direction:column;align-items:center;gap:12px}
.order-box{background:#0062ca;padding:18px;border-radius:12px;color:#fff;width:380px;box-shadow:0 4px 15px rgba(0,0,0,.2)}
.order-box h2{text-align:center;margin:0 0 10px}
input,select,button{width:100%;padding:8px;margin:5px 0;border-radius:6px;border:none;font-size:14px;outline:none}
button{cursor:pointer;font-weight:bold}
.add-btn{background:#28a745;color:#fff}
.serve-btn{background:#007bff;color:#fff}
.cancel-btn{background:#dc3545;color:#fff}
.tables-container{width:380px;display:flex;flex-direction:column;gap:10px}
.table-box{background:#fff;padding:12px;border-radius:10px;position:relative}
.person-box{background:#f0f0f0;padding:8px;border-radius:8px;margin-bottom:6px;display:flex;flex-direction:column;gap:4px}
.item-box{display:flex;justify-content:space-between;margin:2px 0;padding:4px;background:#eee;border-radius:4px;gap:4px;align-items:center}
.table-controls{display:flex;gap:4px;margin-top:6px;flex-wrap:wrap}
.modal-bg{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:none;justify-content:center;align-items:center}
.modal{background:#fff;padding:20px;border-radius:12px;width:320px;max-height:80%;overflow:auto;display:flex;flex-direction:column;gap:12px}
.modal h3{text-align:center;margin:0}
</style>
</head>
<body>

<div class="order-box">
<h2><i class="fas fa-utensils"></i> POS Firebase Ready</h2>

<label>Table</label>
<select id="tableSelect"><option value="" disabled selected>Select table</option></select>

<label>Description</label>
<input id="descriptionInput" placeholder="e.g. John / Veggie" />

<label>Type</label>
<select id="typeSelect">
  <option value="" disabled selected>Select type</option>
  <option value="food">Food</option>
  <option value="drink">Drink</option>
</select>

<label>Item</label>
<select id="itemSelect"><option value="" disabled selected>Select item</option></select>

<label>Quantity</label>
<input id="quantityInput" type="number" min="1" value="1">

<button id="addItemBtn" class="add-btn">Add Item</button>
</div>

<div class="tables-container" id="tablesContainer"></div>

<!-- Payment Modal -->
<div id="paymentModal" class="modal-bg">
<div class="modal">
<h3>Payment</h3>
<div id="paymentContent"></div>
<label>Method</label>
<select id="paymentMethod">
<option value="" disabled selected>Select method</option>
<option value="cash">Cash</option>
<option value="card">Card</option>
<option value="mobile">Mobile</option>
</select>
<button id="payBtn" style="background:#28a745;color:#fff">Pay</button>
<button id="closeModalBtn">Close</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

// Replace these with your real Firebase project info
const firebaseConfig = {
  apiKey: "YOUR_REAL_API_KEY",
  authDomain: "YOUR_REAL_DOMAIN",
  projectId: "YOUR_REAL_PROJECT_ID",
  storageBucket: "YOUR_REAL_BUCKET",
  messagingSenderId: "YOUR_REAL_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const posDocRef = doc(db, 'posData', 'pos');

const tableSelect = document.getElementById('tableSelect');
const descriptionInput = document.getElementById('descriptionInput');
const typeSelect = document.getElementById('typeSelect');
const itemSelect = document.getElementById('itemSelect');
const quantityInput = document.getElementById('quantityInput');
const addItemBtn = document.getElementById('addItemBtn');
const tablesContainer = document.getElementById('tablesContainer');

const paymentModal = document.getElementById('paymentModal');
const paymentContent = document.getElementById('paymentContent');
const paymentMethod = document.getElementById('paymentMethod');
const payBtn = document.getElementById('payBtn');
const closeModalBtn = document.getElementById('closeModalBtn');

let posData = { openTables: [], closedTables: [] };

const menuItems = {
  food: [{item:'Pizza',price:500},{item:'Pasta',price:300},{item:'Burger',price:200}],
  drink: [{item:'Soda',price:50},{item:'Juice',price:80},{item:'Water',price:30}]
};

// Init table options
for(let i=1;i<=13;i++){
  const opt=document.createElement('option'); opt.value=i; opt.textContent=i;
  tableSelect.appendChild(opt);
}

// Update items when type changes
typeSelect.addEventListener('change',()=>{
  itemSelect.innerHTML='<option value="" disabled selected>Select item</option>';
  menuItems[typeSelect.value].forEach(i=>{
    const opt=document.createElement('option');
    opt.value=i.item; opt.dataset.price=i.price;
    opt.textContent = `${i.item} - ${i.price} mts`;
    itemSelect.appendChild(opt);
  });
});

async function savePOS(){ await setDoc(posDocRef, posData); }

onSnapshot(posDocRef, snap=>{
  posData = snap.data()||{openTables:[],closedTables:[]};
  renderTables();
});

// Add order
addItemBtn.addEventListener('click', async()=>{
  const tableNum = tableSelect.value;
  const desc = (descriptionInput.value||'Customer').trim();
  const type = typeSelect.value;
  const itemName = itemSelect.value;
  const price = parseInt(itemSelect.selectedOptions[0].dataset.price);
  const qty = parseInt(quantityInput.value)||1;

  if(!tableNum || !itemName || !type){ alert('Select table, type, and item'); return; }

  let table = posData.openTables.find(t=>t.tableNumber==tableNum);
  if(!table){
    table = {id:'TABLE-'+Date.now(), tableNumber:tableNum, timeOpened:new Date().toISOString(),
      timeClosed:null, tableTotal:0, people:[], merged:false};
    posData.openTables.push(table);
  }

  let person = table.people.find(p=>p.description===desc);
  if(!person){
    person = {id:'PERSON-'+Date.now(), description:desc, orders:[], totalPrice:0, payment:null};
    table.people.push(person);
  }

  person.orders.push({item:itemName,price,quantity:qty,status:'pending',paid:false});
  person.totalPrice = person.orders.reduce((s,o)=>s+o.price*o.quantity,0);
  table.tableTotal = table.people.reduce((s,p)=>s+p.totalPrice,0);

  await savePOS();
  quantityInput.value=1; descriptionInput.value='';
});

// Render tables & all buttons (merge, split, serve, pay, cancel)...
// The rest of renderTables() and showPayment() functions
// are the same as the version I gave before, fully functional.
</script>
</body>
</html>
