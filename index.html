<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simple POS Prototype</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
h2 { margin-top: 40px; }
section { margin-bottom: 30px; }
.order { display: flex; gap: 10px; padding: 6px; border: 1px solid #ccc; margin: 4px 0; align-items: center; }
button { padding: 4px 8px; cursor: pointer; }
.modal-bg { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.4); justify-content:center; align-items:center; }
.modal { background:#fff; padding:20px; border-radius:10px; min-width:300px; }
</style>
</head>
<body>

<h1>Simple POS Prototype</h1>

<!-- Input Section -->
<div>
  <label>Description: <input type="text" id="descInput"></label>
  <label>Type: 
    <select id="typeSelect">
      <option value="" disabled selected>Select type</option>
      <option value="food">Food</option>
      <option value="drink">Drink</option>
    </select>
  </label>
  <label>Item: 
    <select id="itemSelect"><option value="" disabled selected>Select item</option></select>
  </label>
  <label>Quantity: <input type="number" id="qtyInput" min="1" value="1"></label>
  <button id="makeOrderBtn">Make Order</button>
</div>

<!-- Orders Sections -->
<section>
  <h2>Placed Orders</h2>
  <div id="placedOrdersDiv"></div>
</section>

<section>
  <h2>Served Orders</h2>
  <div id="servedOrdersDiv"></div>
</section>

<section>
  <h2>Registered Orders</h2>
  <div id="registeredOrdersDiv"></div>
</section>

<section>
  <h2>Problem Orders</h2>
  <div id="problemOrdersDiv"></div>
</section>

<!-- Problem Modal -->
<div id="problemModal" class="modal-bg">
  <div class="modal">
    <h3>Select Problem</h3>
    <select id="problemSelect">
      <option value="" disabled selected>Select a problem</option>
      <option value="Order was messed up">The order was messed up</option>
      <option value="Client canceled after preparation">Client canceled while it was already prepared</option>
      <option value="Client didn't pay fully">Client didn't pay fully the order</option>
      <option value="Other">Other</option>
    </select>
    <button id="confirmProblemBtn">Confirm</button>
    <button id="closeProblemModal">Close</button>
  </div>
</div>

<script>
const typeSelect = document.getElementById('typeSelect');
const itemSelect = document.getElementById('itemSelect');
const descInput = document.getElementById('descInput');
const qtyInput = document.getElementById('qtyInput');
const makeOrderBtn = document.getElementById('makeOrderBtn');

const placedOrdersDiv = document.getElementById('placedOrdersDiv');
const servedOrdersDiv = document.getElementById('servedOrdersDiv');
const registeredOrdersDiv = document.getElementById('registeredOrdersDiv');
const problemOrdersDiv = document.getElementById('problemOrdersDiv');

const problemModal = document.getElementById('problemModal');
const problemSelect = document.getElementById('problemSelect');
const confirmProblemBtn = document.getElementById('confirmProblemBtn');
const closeProblemModal = document.getElementById('closeProblemModal');

let placedOrders = [];
let servedOrders = [];
let registeredOrders = [];
let problemOrders = [];
let problemTarget = null;

const menuItems = {
  food: ['Pizza','Burger','Pasta'],
  drink: ['Soda','Juice','Water']
};

// Update item list based on type
typeSelect.addEventListener('change', () => {
  itemSelect.innerHTML = '<option value="" disabled selected>Select item</option>';
  (menuItems[typeSelect.value] || []).forEach(i => {
    const opt = document.createElement('option');
    opt.value = i; opt.textContent = i;
    itemSelect.appendChild(opt);
  });
});

// Make order
makeOrderBtn.addEventListener('click', () => {
  const description = descInput.value.trim();
  const type = typeSelect.value;
  const item = itemSelect.value;
  const qty = parseInt(qtyInput.value);

  if(!description || !type || !item || qty<1){ alert('Fill all fields'); return; }

  const order = {
    description, type, item, quantity: qty, time: new Date().toISOString()
  };
  placedOrders.push(order);
  logArrays();
  renderOrders();
  descInput.value=''; qtyInput.value=1; itemSelect.selectedIndex=0; typeSelect.selectedIndex=0;
});

// Render all sections
function renderOrders() {
  renderSection(placedOrdersDiv, placedOrders, ['Cancel','Serve','Problem'], handlePlacedAction);
  renderSection(servedOrdersDiv, servedOrders, ['Pay','Problem'], handleServedAction);
  renderSection(registeredOrdersDiv, registeredOrders, [], null);
  renderSection(problemOrdersDiv, problemOrders, [], null);
}

function renderSection(container, arr, buttons=[], handler) {
  container.innerHTML = '';
  arr.forEach((order, index) => {
    const div = document.createElement('div');
    div.className='order';
    div.textContent = `[${order.description}] ${order.item} x${order.quantity}`;
    buttons.forEach(btnName => {
      const btn = document.createElement('button');
      btn.textContent = btnName;
      btn.addEventListener('click', ()=>handler(order,index,btnName));
      div.appendChild(btn);
    });
    container.appendChild(div);
  });
}

// Handlers
function handlePlacedAction(order,index,action){
  if(action==='Cancel'){ placedOrders.splice(index,1); }
  else if(action==='Serve'){ 
    servedOrders.push(order); placedOrders.splice(index,1);
  } else if(action==='Problem'){ openProblemModal(order,'placed',index); }
  logArrays(); renderOrders();
}

function handleServedAction(order,index,action){
  if(action==='Pay'){
    const paidOrder = {...order}; paidOrder.price = 100*order.quantity; // dummy price
    registeredOrders.push(paidOrder); 
    servedOrders.splice(index,1);
  } else if(action==='Problem'){ openProblemModal(order,'served',index); }
  logArrays(); renderOrders();
}

// Problem modal
function openProblemModal(order,sectionName,index){
  problemModal.style.display='flex';
  problemTarget = {order, sectionName, index};
}

confirmProblemBtn.addEventListener('click', ()=>{
  const selected = problemSelect.value;
  if(!selected){ alert('Select a problem'); return; }
  const {order,sectionName,index} = problemTarget;

  const problemOrder = {...order, problemDescription:selected};
  problemOrders.push(problemOrder);
  const registeredCopy = {...order, price:0, problemDescription:selected};
  registeredOrders.push(registeredCopy);

  if(sectionName==='placed'){ placedOrders.splice(index,1); }
  else if(sectionName==='served'){ servedOrders.splice(index,1); }

  problemModal.style.display='none';
  problemSelect.selectedIndex=0;
  problemTarget = null;
  logArrays();
  renderOrders();
});

closeProblemModal.addEventListener('click', ()=>{
  problemModal.style.display='none';
  problemTarget=null;
});

function logArrays(){
  console.log('Placed Orders:',placedOrders);
  console.log('Served Orders:',servedOrders);
  console.log('Registered Orders:',registeredOrders);
  console.log('Problem Orders:',problemOrders);
}

renderOrders();
</script>

</body>
</html>
